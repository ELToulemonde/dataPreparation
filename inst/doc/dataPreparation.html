<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="date" content="2017-10-12" />

<title>dataPreparation</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">dataPreparation</h1>
<h4 class="date"><em>2017-10-12</em></h4>



<p>This vignette introduces <em>dataPreparation</em> package (v0.2), what it offers, how simple it is to use it.</p>
<div id="introduction" class="section level1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<div id="package-presentation" class="section level2">
<h2><span class="header-section-number">1.1</span> Package presentation</h2>
<p>Based on <a href="http://r-datatable.com">data.table</a> package, <strong>dataPreparation</strong> will allow you to do most of the painful data preparation for a data science project with a minimum amount of code.</p>
<p>This package is</p>
<ul>
<li>fast (use <code>data.table</code> and exponential search)</li>
<li>RAM efficient (perform operations by reference and column-wise to avoid copying data)</li>
<li>stable (most exceptions are handled)</li>
<li>verbose (log a lot)</li>
</ul>
<p><code>data.table</code> and other dependencies are handled at installation.</p>
</div>
<div id="main-preparation-steps" class="section level2">
<h2><span class="header-section-number">1.2</span> Main preparation steps</h2>
<p>Before using any machine learning (ML) algorithm, one needs to prepare its data. Preparing a data set for a data science project can be long and tricky. The main steps are the followings:</p>
<ul>
<li><strong>Read</strong>: load the data set (this package don’t treat this point: for csv we recommend <code>data.table::fread</code>)</li>
<li><strong>Correct</strong>: most of the times, there are some mistake after reading, wrong format… one have to correct them</li>
<li><strong>Transform</strong>: creating new features from date, categorical, character… in order to have information usable for a ML algorithm (aka: numeric or categorical)</li>
<li><strong>Filter</strong>: get read of useless information in order to speed up computation</li>
<li><strong>Handle NA</strong>: replace missing values</li>
<li><strong>Shape</strong>: put your data set in a nice shape usable by a ML algorithm</li>
</ul>
<p>Here are the functions available in this package to tackle those issues:</p>
<table>
<thead>
<tr class="header">
<th>Correct</th>
<th>Transform</th>
<th>Filter</th>
<th>Handle NA</th>
<th>Shape</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>unFactor</td>
<td>generateDateDiffs</td>
<td>fastFilterVariables</td>
<td>fastHandleNa</td>
<td>shapeSet</td>
</tr>
<tr class="even">
<td>findAndTransformDates</td>
<td>generateFactorFromDate</td>
<td>whichAreConstant</td>
<td></td>
<td>sameShape</td>
</tr>
<tr class="odd">
<td>findAndTransformNumerics</td>
<td>aggregateByKey</td>
<td>whichAreInDouble</td>
<td></td>
<td>setAsNumericMatrix</td>
</tr>
<tr class="even">
<td>setColAsCharacter</td>
<td>generateFromFactor</td>
<td>whichAreBijection</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>setColAsNumeric</td>
<td>generateFromCharacter</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>setColAsDate</td>
<td>fastRound</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>setColAsFactor</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>All of those functions are integrated in the <strong>full pipeline</strong> function <code>prepareSet</code>.</p>
<p>In this tutorial we will detail all those steps and how to treat them with this package using an example data set.</p>
</div>
<div id="tutorial-data" class="section level2">
<h2><span class="header-section-number">1.3</span> Tutorial data</h2>
<p>For this tutorial, we are going to use a <em>messy</em> version of <a href="https://archive.ics.uci.edu/ml/datasets/adult">adult</a> data base.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(messy_adult)
<span class="kw">print</span>(<span class="kw">head</span>(messy_adult, <span class="dt">n =</span> <span class="dv">4</span>))</code></pre></div>
<pre><code>#         date1      date2       date3            date4    num1    num2
# 1:  2017-22-7 1501369200 23-Feb-2017 25-february-2017  1.3131 -1,2735
# 2:   2017-4-3         NA 21-Jun-2017     23-june-2017      NA  0,2207
# 3:  2017-14-6 1489878000 10-May-2017      12-may-2017  0.4781      NA
# 4: 2017-14-11 1514674800 12-Feb-2017 14-february-2017 -0.1055  0,1261
#    constant                         mail    num3 age    type_employer
# 1:        1  cynthia.jake@protonmail.com  1,3131  39        State-gov
# 2:        1                           NA      NA  50 Self-emp-not-inc
# 3:        1 caroline.jake@protonmail.com  0,4781  38          Private
# 4:        1     cynthia.pierre@yahoo.com -0,1055  53          Private
#    fnlwgt education education_num            marital        occupation
# 1:  77516 Bachelors            13      Never-married      Adm-clerical
# 2:  83311 Bachelors            13 Married-civ-spouse   Exec-managerial
# 3: 215646   HS-grad             9           Divorced Handlers-cleaners
# 4: 234721      11th             7 Married-civ-spouse Handlers-cleaners
#     relationship  race  sex capital_gain capital_loss hr_per_week
# 1: Not-in-family White Male         2174            0          40
# 2:       Husband White Male            0            0          13
# 3: Not-in-family White Male            0            0          40
# 4:       Husband Black Male            0            0          40
#          country income
# 1: United-States  &lt;=50K
# 2: United-States  &lt;=50K
# 3: United-States  &lt;=50K
# 4: United-States  &lt;=50K</code></pre>
<p>We added 9 really ugly columns to the data set:</p>
<ul>
<li>4 dates with various formats, or time stamps, and NAs</li>
<li>1 constant column</li>
<li>3 numeric with different decimal separator</li>
<li>1 email address</li>
</ul>
<p>The same info can be contained in two different columns.</p>
</div>
</div>
<div id="correct-functions" class="section level1">
<h1><span class="header-section-number">2</span> <em>Correct</em> functions</h1>
<div id="identifying-factor-that-shouldnt-be" class="section level2">
<h2><span class="header-section-number">2.1</span> Identifying factor that shouldn’t be</h2>
<p>It often happens when reading a data set that R put string into a factor even if it shouldn’t be. In this tutorial data set, <code>mail</code> is a factor but shouldn’t be. It will automatically be detected using <code>unFactor</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(<span class="kw">class</span>(messy_adult$mail))</code></pre></div>
<pre><code># &quot;factor&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">messy_adult &lt;-<span class="st"> </span><span class="kw">unFactor</span>(messy_adult)</code></pre></div>
<pre><code># &quot;unFactor: I will identify variable that are factor but shouldn't be.&quot;
# &quot;unFactor: I unfactor mail.&quot;
# &quot;unFactor: It took me 0.24s to unfactor 1 column(s).&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(<span class="kw">class</span>(messy_adult$mail))</code></pre></div>
<pre><code># &quot;character&quot;</code></pre>
</div>
<div id="identifing-and-transforming-date-columns" class="section level2">
<h2><span class="header-section-number">2.2</span> Identifing and transforming date columns</h2>
<p>The next thing to do is to <strong>identify</strong> columns that are dates (the first 4 ones) and <strong>transform</strong> them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">messy_adult &lt;-<span class="st"> </span><span class="kw">findAndTransformDates</span>(messy_adult)</code></pre></div>
<pre><code># &quot;findAndTransformDates: It took me 0.89s to identify formats&quot;
# &quot;findAndTransformDates: It took me 0.06s to transform 4 columns to a Date format.&quot;</code></pre>
Let’s have a look to the transformation performed on those 4 columns:
<table class="table table-striped table-hover" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
date1_prev
</th>
<th style="text-align:right;">
date2_prev
</th>
<th style="text-align:left;">
date3_prev
</th>
<th style="text-align:left;">
date4_prev
</th>
<th style="text-align:left;">
transfo
</th>
<th style="text-align:left;">
date1
</th>
<th style="text-align:left;">
date2
</th>
<th style="text-align:left;">
date3
</th>
<th style="text-align:left;">
date4
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2017-22-7
</td>
<td style="text-align:right;">
1501369200
</td>
<td style="text-align:left;">
23-Feb-2017
</td>
<td style="text-align:left;">
25-february-2017
</td>
<td style="text-align:left;">
=&gt;
</td>
<td style="text-align:left;">
2017-07-22
</td>
<td style="text-align:left;">
2017-07-30 01:00:00
</td>
<td style="text-align:left;">
2017-02-23
</td>
<td style="text-align:left;">
2017-02-25
</td>
</tr>
<tr>
<td style="text-align:left;">
2017-4-3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
21-Jun-2017
</td>
<td style="text-align:left;">
23-june-2017
</td>
<td style="text-align:left;">
=&gt;
</td>
<td style="text-align:left;">
2017-03-04
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
2017-06-21
</td>
<td style="text-align:left;">
2017-06-23
</td>
</tr>
<tr>
<td style="text-align:left;">
2017-14-6
</td>
<td style="text-align:right;">
1489878000
</td>
<td style="text-align:left;">
10-May-2017
</td>
<td style="text-align:left;">
12-may-2017
</td>
<td style="text-align:left;">
=&gt;
</td>
<td style="text-align:left;">
2017-06-14
</td>
<td style="text-align:left;">
2017-03-19 00:00:00
</td>
<td style="text-align:left;">
2017-05-10
</td>
<td style="text-align:left;">
2017-05-12
</td>
</tr>
<tr>
<td style="text-align:left;">
2017-14-11
</td>
<td style="text-align:right;">
1514674800
</td>
<td style="text-align:left;">
12-Feb-2017
</td>
<td style="text-align:left;">
14-february-2017
</td>
<td style="text-align:left;">
=&gt;
</td>
<td style="text-align:left;">
2017-11-14
</td>
<td style="text-align:left;">
2017-12-31 00:00:00
</td>
<td style="text-align:left;">
2017-02-12
</td>
<td style="text-align:left;">
2017-02-14
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:right;">
1494889200
</td>
<td style="text-align:left;">
02-Dec-2017
</td>
<td style="text-align:left;">
04-december-2017
</td>
<td style="text-align:left;">
=&gt;
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
2017-05-16 01:00:00
</td>
<td style="text-align:left;">
2017-12-02
</td>
<td style="text-align:left;">
2017-12-04
</td>
</tr>
<tr>
<td style="text-align:left;">
2017-29-12
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
07-Jun-2017
</td>
<td style="text-align:left;">
09-june-2017
</td>
<td style="text-align:left;">
=&gt;
</td>
<td style="text-align:left;">
2017-12-29
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
2017-06-07
</td>
<td style="text-align:left;">
2017-06-09
</td>
</tr>
</tbody>
</table>
<p>As one can see, even if formats were different and somehow ugly, they were all handled.</p>
</div>
<div id="identifying-and-transforming-numeric-columns" class="section level2">
<h2><span class="header-section-number">2.3</span> Identifying and transforming numeric columns</h2>
<p>And now the same thing with numeric</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">messy_adult &lt;-<span class="st"> </span><span class="kw">findAndTransformNumerics</span>(messy_adult)</code></pre></div>
<pre><code># &quot;findAndTransformNumerics: It took me 0.33s to identify 3 numerics column(s), i will set them as numerics&quot;
# &quot;setColAsNumeric: I will set some columns as numeric&quot;
# &quot;setColAsNumeric: I am doing the column num1.&quot;
# &quot;setColAsNumeric: 0 NA have been created due to transformation to numeric.&quot;
# &quot;setColAsNumeric: I will set some columns as numeric&quot;
# &quot;setColAsNumeric: I am doing the column num2.&quot;
# &quot;setColAsNumeric: 0 NA have been created due to transformation to numeric.&quot;
# &quot;setColAsNumeric: I am doing the column num3.&quot;
# &quot;setColAsNumeric: 0 NA have been created due to transformation to numeric.&quot;
# &quot;findAndTransformNumerics: It took me 0.05s to transform 3 column(s) to a numeric format.&quot;</code></pre>
<table class="table table-striped table-hover" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
num1_prev
</th>
<th style="text-align:left;">
num2_prev
</th>
<th style="text-align:left;">
num3_prev
</th>
<th style="text-align:left;">
transfo
</th>
<th style="text-align:right;">
num1
</th>
<th style="text-align:right;">
num2
</th>
<th style="text-align:right;">
num3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
1.3131
</td>
<td style="text-align:left;">
-1,2735
</td>
<td style="text-align:left;">
1,3131
</td>
<td style="text-align:left;">
=&gt;
</td>
<td style="text-align:right;">
1.3131
</td>
<td style="text-align:right;">
-1.2735
</td>
<td style="text-align:right;">
1.3131
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
0,2207
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
=&gt;
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.2207
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
0.4781
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
0,4781
</td>
<td style="text-align:left;">
=&gt;
</td>
<td style="text-align:right;">
0.4781
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.4781
</td>
</tr>
<tr>
<td style="text-align:left;">
-0.1055
</td>
<td style="text-align:left;">
0,1261
</td>
<td style="text-align:left;">
-0,1055
</td>
<td style="text-align:left;">
=&gt;
</td>
<td style="text-align:right;">
-0.1055
</td>
<td style="text-align:right;">
0.1261
</td>
<td style="text-align:right;">
-0.1055
</td>
</tr>
<tr>
<td style="text-align:left;">
-0.0711
</td>
<td style="text-align:left;">
-1,6509
</td>
<td style="text-align:left;">
-0,0711
</td>
<td style="text-align:left;">
=&gt;
</td>
<td style="text-align:right;">
-0.0711
</td>
<td style="text-align:right;">
-1.6509
</td>
<td style="text-align:right;">
-0.0711
</td>
</tr>
<tr>
<td style="text-align:left;">
-0.3239
</td>
<td style="text-align:left;">
-1,5692
</td>
<td style="text-align:left;">
-0,3239
</td>
<td style="text-align:left;">
=&gt;
</td>
<td style="text-align:right;">
-0.3239
</td>
<td style="text-align:right;">
-1.5692
</td>
<td style="text-align:right;">
-0.3239
</td>
</tr>
</tbody>
</table>
<p>So now our data set is a bit less ugly.</p>
</div>
</div>
<div id="filter-functions" class="section level1">
<h1><span class="header-section-number">3</span> <em>Filter</em> functions</h1>
<p>The idea now is to identify useless columns:</p>
<ul>
<li><em>constant</em> columns: they take the same value for every line,</li>
<li><em>double</em> columns: they have an exact copy in the data set,</li>
<li><em>bijection</em> columns: there is another column containing the exact same information (but maybe coded differently) for example col1: Men/Women, col2 M/W.</li>
</ul>
<div id="look-for-constant-variables" class="section level2">
<h2><span class="header-section-number">3.1</span> Look for constant variables</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">constant_cols &lt;-<span class="st"> </span><span class="kw">whichAreConstant</span>(messy_adult)</code></pre></div>
<pre><code># &quot;whichAreConstant: constant is constant.&quot;
# &quot;whichAreConstant: it took me 0.31s to identify 1 constant column(s)&quot;</code></pre>
</div>
<div id="look-for-columns-in-double" class="section level2">
<h2><span class="header-section-number">3.2</span> Look for columns in double</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">double_cols &lt;-<span class="st"> </span><span class="kw">whichAreInDouble</span>(messy_adult)</code></pre></div>
<pre><code># &quot;whichAreInDouble: num3 is exactly equal to num1. I put it in drop list.&quot;
# &quot;whichAreInDouble: it took me 0.28s to identify 1 column(s) to drop.&quot;</code></pre>
</div>
<div id="look-for-columns-that-are-bijections-of-one-another" class="section level2">
<h2><span class="header-section-number">3.3</span> Look for columns that are bijections of one another</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bijections_cols &lt;-<span class="st"> </span><span class="kw">whichAreBijection</span>(messy_adult)</code></pre></div>
<pre><code># &quot;whichAreBijection: date4 is a bijection of date3. I put it in drop list.&quot;
# &quot;whichAreBijection: num3 is a bijection of num1. I put it in drop list.&quot;
# &quot;whichAreBijection: education_num is a bijection of education. I put it in drop list.&quot;
# &quot;whichAreBijection: it took me 0.62s to identify 3 column(s) to drop.&quot;</code></pre>
To control this, let’s have a look to the concerned columns:
<table class="table table-striped table-hover" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
constant
</th>
<th style="text-align:left;">
date3
</th>
<th style="text-align:left;">
date4
</th>
<th style="text-align:right;">
num1
</th>
<th style="text-align:right;">
num3
</th>
<th style="text-align:left;">
education
</th>
<th style="text-align:right;">
education_num
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-02-23
</td>
<td style="text-align:left;">
2017-02-25
</td>
<td style="text-align:right;">
1.3131
</td>
<td style="text-align:right;">
1.3131
</td>
<td style="text-align:left;">
Bachelors
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-06-21
</td>
<td style="text-align:left;">
2017-06-23
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
Bachelors
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-05-10
</td>
<td style="text-align:left;">
2017-05-12
</td>
<td style="text-align:right;">
0.4781
</td>
<td style="text-align:right;">
0.4781
</td>
<td style="text-align:left;">
HS-grad
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-02-12
</td>
<td style="text-align:left;">
2017-02-14
</td>
<td style="text-align:right;">
-0.1055
</td>
<td style="text-align:right;">
-0.1055
</td>
<td style="text-align:left;">
11th
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-12-02
</td>
<td style="text-align:left;">
2017-12-04
</td>
<td style="text-align:right;">
-0.0711
</td>
<td style="text-align:right;">
-0.0711
</td>
<td style="text-align:left;">
Bachelors
</td>
<td style="text-align:right;">
13
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
2017-06-07
</td>
<td style="text-align:left;">
2017-06-09
</td>
<td style="text-align:right;">
-0.3239
</td>
<td style="text-align:right;">
-0.3239
</td>
<td style="text-align:left;">
Masters
</td>
<td style="text-align:right;">
14
</td>
</tr>
</tbody>
</table>
<p>Indeed:</p>
<ul>
<li><em>constant</em> was build constant, it contains only 1,</li>
<li><em>num1</em> and <em>num3</em> are equal,</li>
<li><em>date3</em> and <em>date4</em> are separated by 2 days: date4 doesn’t contain any new information for a ML algorithm,</li>
<li><em>education</em> and <em>education_num</em> contains the same information one with a key index, the other one with the character corresponding. <code>whichAreBijection</code> keeps the character column.</li>
</ul>
</div>
<div id="filter-them-all" class="section level2">
<h2><span class="header-section-number">3.4</span> Filter them all</h2>
<p>To directly filter all of them:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ncols &lt;-<span class="st"> </span><span class="kw">ncol</span>(messy_adult)
messy_adult &lt;-<span class="st"> </span><span class="kw">fastFilterVariables</span>(messy_adult)
<span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&quot;messy_adult now have &quot;</span>, <span class="kw">ncol</span>(messy_adult), <span class="st">&quot; columns; so &quot;</span>, ncols -<span class="st"> </span><span class="kw">ncol</span>(messy_adult), <span class="st">&quot; less than before.&quot;</span>))</code></pre></div>
<pre><code># &quot;fastFilterVariables: I check for constant columns.&quot;
# &quot;fastFilterVariables: I delete 1 constant column(s) in dataSet.&quot;
# &quot;fastFilterVariables: I check for columns in double.&quot;
# &quot;fastFilterVariables: I delete 1 column(s) that are in double in dataSet.&quot;
# &quot;fastFilterVariables: I check for columns that are bijections of another column.&quot;
# &quot;fastFilterVariables: I delete 2 column(s) that are bijections of another column in dataSet.&quot;
# &quot;messy_adult now have 20 columns; so 4 less than before.&quot;</code></pre>
<p>4 useless rows have been deleted. Without those useless columns, your machine learning algorithm will at least be faster and maybe give better results.</p>
</div>
</div>
<div id="transform-functions" class="section level1">
<h1><span class="header-section-number">4</span> <em>Transform</em> functions</h1>
<p>Before sending this to a machine learning algorithm, a few transformations should be performed.</p>
<p>The idea with the functions presented here is to perform those transformations in a RAM efficient way.</p>
<div id="dates-differences" class="section level2">
<h2><span class="header-section-number">4.1</span> Dates differences</h2>
<p>Since no machine learning algorithm handle Dates, one needs to transform them or drop them. A way to transform dates is to perform differences between every date.</p>
<p>We can also add an analysis date to compare dates with the date your data is from. For example, if you have a birth-date you may want to compute age by performing today - birth-date.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">messy_adult &lt;-<span class="st"> </span><span class="kw">generateDateDiffs</span>(messy_adult, <span class="dt">cols =</span> <span class="st">&quot;auto&quot;</span>, <span class="dt">analysisDate =</span> <span class="kw">as.Date</span>(<span class="st">&quot;2018-01-01&quot;</span>), <span class="dt">units =</span> <span class="st">&quot;days&quot;</span>)</code></pre></div>
<pre><code># &quot;generateDateDiffs: I will generate difference between dates.&quot;
# &quot;generateDateDiffs: It took me 0.02s to create 6 column(s).&quot;</code></pre>
<table class="table table-striped table-hover" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
…
</th>
<th style="text-align:right;">
date1.Minus.date3
</th>
<th style="text-align:right;">
date1.Minus.analysisDate
</th>
<th style="text-align:right;">
date2.Minus.date3
</th>
<th style="text-align:right;">
date2.Minus.analysisDate
</th>
<th style="text-align:right;">
date3.Minus.analysisDate
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
…
</td>
<td style="text-align:right;">
149
</td>
<td style="text-align:right;">
-162.958333
</td>
<td style="text-align:right;">
156.95833
</td>
<td style="text-align:right;">
-155
</td>
<td style="text-align:right;">
-311.95833
</td>
</tr>
<tr>
<td style="text-align:left;">
…
</td>
<td style="text-align:right;">
-109
</td>
<td style="text-align:right;">
-302.958333
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
-193.95833
</td>
</tr>
<tr>
<td style="text-align:left;">
…
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
-200.958333
</td>
<td style="text-align:right;">
-52.04167
</td>
<td style="text-align:right;">
-288
</td>
<td style="text-align:right;">
-235.95833
</td>
</tr>
<tr>
<td style="text-align:left;">
…
</td>
<td style="text-align:right;">
275
</td>
<td style="text-align:right;">
-47.958333
</td>
<td style="text-align:right;">
321.95833
</td>
<td style="text-align:right;">
-1
</td>
<td style="text-align:right;">
-322.95833
</td>
</tr>
<tr>
<td style="text-align:left;">
…
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
-200.04167
</td>
<td style="text-align:right;">
-230
</td>
<td style="text-align:right;">
-29.95833
</td>
</tr>
<tr>
<td style="text-align:left;">
…
</td>
<td style="text-align:right;">
205
</td>
<td style="text-align:right;">
-2.958333
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
-207.95833
</td>
</tr>
</tbody>
</table>
</div>
<div id="transforming-dates-into-aggregates" class="section level2">
<h2><span class="header-section-number">4.2</span> Transforming dates into aggregates</h2>
<p>Another way to work around dates would be to aggregate them at some level. This time <code>drop</code> is set to <code>TRUE</code> in order to drop date columns.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">messy_adult &lt;-<span class="st"> </span><span class="kw">generateFactorFromDate</span>(messy_adult, <span class="dt">cols =</span> <span class="st">&quot;auto&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;quarter&quot;</span>, <span class="dt">drop =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code># &quot;generateFactorFromDate:autoaren't columns of the table, i do nothing for those variables&quot;
# &quot;generateFactorFromDate: I will create a factor column from each date column.&quot;
# &quot;generateFactorFromDate: It took me 0.31s to transform 3 column(s).&quot;</code></pre>
<table class="table table-striped table-hover" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
…
</th>
<th style="text-align:left;">
date1.quarter
</th>
<th style="text-align:left;">
date2.quarter
</th>
<th style="text-align:left;">
date3.quarter
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
…
</td>
<td style="text-align:left;">
Q3
</td>
<td style="text-align:left;">
Q3
</td>
<td style="text-align:left;">
Q1
</td>
</tr>
<tr>
<td style="text-align:left;">
…
</td>
<td style="text-align:left;">
Q1
</td>
<td style="text-align:left;">
QNA
</td>
<td style="text-align:left;">
Q2
</td>
</tr>
<tr>
<td style="text-align:left;">
…
</td>
<td style="text-align:left;">
Q2
</td>
<td style="text-align:left;">
Q1
</td>
<td style="text-align:left;">
Q2
</td>
</tr>
<tr>
<td style="text-align:left;">
…
</td>
<td style="text-align:left;">
Q4
</td>
<td style="text-align:left;">
Q4
</td>
<td style="text-align:left;">
Q1
</td>
</tr>
<tr>
<td style="text-align:left;">
…
</td>
<td style="text-align:left;">
QNA
</td>
<td style="text-align:left;">
Q2
</td>
<td style="text-align:left;">
Q4
</td>
</tr>
<tr>
<td style="text-align:left;">
…
</td>
<td style="text-align:left;">
Q4
</td>
<td style="text-align:left;">
QNA
</td>
<td style="text-align:left;">
Q2
</td>
</tr>
</tbody>
</table>
</div>
<div id="generate-features-from-character-columns" class="section level2">
<h2><span class="header-section-number">4.3</span> Generate features from character columns</h2>
<p>Character columns are not handled by any machine learning algorithm, one should transform them. Function <code>generateFromCharacter</code> build some new feature from them, and then drop them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">messy_adult &lt;-<span class="st"> </span><span class="kw">generateFromCharacter</span>(messy_adult, <span class="dt">cols =</span> <span class="st">&quot;auto&quot;</span>, <span class="dt">drop =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code># &quot;generateFromCharacter: it took me: 0.01s to transform 1 character columns into, 3 new columns.&quot;</code></pre>
<table class="table table-striped table-hover" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
mail.notnull
</th>
<th style="text-align:right;">
mail.num
</th>
<th style="text-align:right;">
mail.order
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
197
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
197
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
197
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
197
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
197
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
197
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
</div>
<div id="aggregate-according-to-a-key" class="section level2">
<h2><span class="header-section-number">4.4</span> Aggregate according to a key</h2>
<p>To model something by country; one would want to to compute an aggregation of this table in order to have one line per country.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">agg_adult &lt;-<span class="st"> </span><span class="kw">aggregateByKey</span>(messy_adult, <span class="dt">key =</span> <span class="st">&quot;country&quot;</span>)</code></pre></div>
<pre><code># &quot;aggregateByKey: I start to aggregate&quot;
# &quot;aggregateByKey: 139 columns have been constructed. It took 0.58 seconds. &quot;</code></pre>
<table class="table table-striped table-hover" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
max.age
</th>
<th style="text-align:right;">
type_employer.Without-pay
</th>
<th style="text-align:right;">
education.Assoc-acdm
</th>
<th style="text-align:right;">
marital.Married-AF-spouse
</th>
<th style="text-align:left;">
…
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
?
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
…
</td>
</tr>
<tr>
<td style="text-align:left;">
Cambodia
</td>
<td style="text-align:right;">
65
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
…
</td>
</tr>
<tr>
<td style="text-align:left;">
Canada
</td>
<td style="text-align:right;">
73
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
…
</td>
</tr>
<tr>
<td style="text-align:left;">
China
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
…
</td>
</tr>
<tr>
<td style="text-align:left;">
Columbia
</td>
<td style="text-align:right;">
75
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
…
</td>
</tr>
<tr>
<td style="text-align:left;">
Cuba
</td>
<td style="text-align:right;">
82
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
…
</td>
</tr>
</tbody>
</table>
<p>Every time you have more than one line per individual this function would be pretty cool.</p>
</div>
<div id="rounding" class="section level2">
<h2><span class="header-section-number">4.5</span> Rounding</h2>
<p>One might want to round numeric variables in order to save some RAM, or for algorithmic reasons:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">messy_adult &lt;-<span class="st"> </span><span class="kw">fastRound</span>(messy_adult, <span class="dt">digits =</span> <span class="dv">2</span>)</code></pre></div>
<table class="table table-striped table-hover" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
num1
</th>
<th style="text-align:right;">
num2
</th>
<th style="text-align:right;">
age
</th>
<th style="text-align:left;">
type_employer
</th>
<th style="text-align:right;">
fnlwgt
</th>
<th style="text-align:left;">
education
</th>
<th style="text-align:left;">
…
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:left;">
Private
</td>
<td style="text-align:right;">
386940
</td>
<td style="text-align:left;">
Bachelors
</td>
<td style="text-align:left;">
…
</td>
</tr>
<tr>
<td style="text-align:right;">
-1.44
</td>
<td style="text-align:right;">
2.05
</td>
<td style="text-align:right;">
27
</td>
<td style="text-align:left;">
Private
</td>
<td style="text-align:right;">
213921
</td>
<td style="text-align:left;">
HS-grad
</td>
<td style="text-align:left;">
…
</td>
</tr>
<tr>
<td style="text-align:right;">
-0.04
</td>
<td style="text-align:right;">
-0.19
</td>
<td style="text-align:right;">
41
</td>
<td style="text-align:left;">
Self-emp-not-inc
</td>
<td style="text-align:right;">
143129
</td>
<td style="text-align:left;">
Bachelors
</td>
<td style="text-align:left;">
…
</td>
</tr>
<tr>
<td style="text-align:right;">
0.67
</td>
<td style="text-align:right;">
0.74
</td>
<td style="text-align:right;">
37
</td>
<td style="text-align:left;">
Local-gov
</td>
<td style="text-align:right;">
186035
</td>
<td style="text-align:left;">
Some-college
</td>
<td style="text-align:left;">
…
</td>
</tr>
<tr>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.55
</td>
<td style="text-align:right;">
24
</td>
<td style="text-align:left;">
Private
</td>
<td style="text-align:right;">
354351
</td>
<td style="text-align:left;">
HS-grad
</td>
<td style="text-align:left;">
…
</td>
</tr>
<tr>
<td style="text-align:right;">
-0.47
</td>
<td style="text-align:right;">
1.25
</td>
<td style="text-align:right;">
37
</td>
<td style="text-align:left;">
Private
</td>
<td style="text-align:right;">
327323
</td>
<td style="text-align:left;">
5th-6th
</td>
<td style="text-align:left;">
…
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="handling-nas-values" class="section level1">
<h1><span class="header-section-number">5</span> Handling NAs values</h1>
<p>Then, let’s handle NAs</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">messy_adult &lt;-<span class="st"> </span><span class="kw">fastHandleNa</span>(messy_adult)</code></pre></div>
<pre><code>#     num1  num2 age    type_employer   ...       country income
# 1:  0.00  0.05  45          Private   ... United-States  &lt;=50K
# 2: -1.44  2.05  27          Private   ...        Mexico  &lt;=50K
# 3: -0.04 -0.19  41 Self-emp-not-inc   ... United-States  &lt;=50K
# 4:  0.67  0.74  37        Local-gov   ... United-States   &gt;50K
#    date1.Minus.date2 date1.Minus.date3 date1.Minus.analysisDate
# 1:              0.04              -196                  -341.96
# 2:           -185.96              -111                  -260.96
# 3:            191.04               282                   -27.96
# 4:            -32.96              -118                  -262.96
#    date2.Minus.date3 date2.Minus.analysisDate date3.Minus.analysisDate
# 1:           -196.04                     -342                  -145.96
# 2:             74.96                      -75                  -149.96
# 3:             90.96                     -219                  -309.96
# 4:            -85.04                     -230                  -144.96
#    date1.quarter date2.quarter date3.quarter mail.notnull mail.num
# 1:            Q1            Q1            Q3        FALSE      197
# 2:            Q2            Q4            Q3        FALSE      197
# 3:            Q4            Q2            Q1        FALSE      197
# 4:            Q2            Q2            Q3        FALSE      197
#    mail.order
# 1:          1
# 2:          1
# 3:          1
# 4:          1</code></pre>
<p>It set default values in place of NA. If you want to put some specific values (constants, or even a function for example mean of values) you should go check <code>fastHandleNa</code> documentation.</p>
</div>
<div id="shape-functions" class="section level1">
<h1><span class="header-section-number">6</span> Shape functions</h1>
<p>There are two types of machine learning algorithm in R: those which accept data.table and factor, those which only accept numeric matrix.</p>
<p>Transforming a data set into something acceptable for a machine learning algorithm could be tricky.</p>
<p>The <code>shapeSet</code> function do it for you, you just have to choose if you want a <em>data.table</em> or a <em>numerical_matrix</em>.</p>
<p>First with <em>data.table</em>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clean_adult =<span class="st"> </span><span class="kw">shapeSet</span>(<span class="kw">copy</span>(messy_adult), <span class="dt">finalForm =</span> <span class="st">&quot;data.table&quot;</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)
<span class="kw">print</span>(<span class="kw">table</span>(<span class="kw">sapply</span>(clean_adult, class)))</code></pre></div>
<pre><code># 
#  factor integer numeric 
#      12       1      15</code></pre>
<p>As one can see, there only are, numeric and factors.</p>
<p>Now with <em>numerical_matrix</em>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clean_adult &lt;-<span class="st"> </span><span class="kw">shapeSet</span>(<span class="kw">copy</span>(messy_adult), <span class="dt">finalForm =</span> <span class="st">&quot;numerical_matrix&quot;</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</code></pre></div>
<table class="table table-striped table-hover" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
num1
</th>
<th style="text-align:right;">
num2
</th>
<th style="text-align:right;">
age
</th>
<th style="text-align:right;">
type_employer?
</th>
<th style="text-align:right;">
type_employerFederal-gov
</th>
<th style="text-align:right;">
type_employerLocal-gov
</th>
<th style="text-align:left;">
…
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
45
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
…
</td>
</tr>
<tr>
<td style="text-align:right;">
-1.44
</td>
<td style="text-align:right;">
2.05
</td>
<td style="text-align:right;">
27
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
…
</td>
</tr>
<tr>
<td style="text-align:right;">
-0.04
</td>
<td style="text-align:right;">
-0.19
</td>
<td style="text-align:right;">
41
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
…
</td>
</tr>
<tr>
<td style="text-align:right;">
0.67
</td>
<td style="text-align:right;">
0.74
</td>
<td style="text-align:right;">
37
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
…
</td>
</tr>
<tr>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.55
</td>
<td style="text-align:right;">
24
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
…
</td>
</tr>
<tr>
<td style="text-align:right;">
-0.47
</td>
<td style="text-align:right;">
1.25
</td>
<td style="text-align:right;">
37
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
…
</td>
</tr>
</tbody>
</table>
<p>As one can see, with <code>finalForm = &quot;numerical_matrix&quot;</code> every character and factor have been binarized.</p>
</div>
<div id="full-pipeline" class="section level1">
<h1><span class="header-section-number">7</span> Full pipeline</h1>
<p>Doing it all with one function is possible:</p>
<p>To do that we will reload the ugly data set and perform aggregation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;messy_adult&quot;</span>)
agg_adult &lt;-<span class="st"> </span><span class="kw">prepareSet</span>(messy_adult, <span class="dt">finalForm =</span> <span class="st">&quot;data.table&quot;</span>, <span class="dt">key =</span> <span class="st">&quot;country&quot;</span>, <span class="dt">analysisDate =</span> <span class="kw">Sys.Date</span>(), <span class="dt">digits =</span> <span class="dv">2</span>)</code></pre></div>
<pre><code># &quot;prepareSet: step one: correcting mistakes.&quot;
# &quot;fastFilterVariables: I check for constant columns.&quot;
# &quot;fastFilterVariables: I delete 1 constant column(s) in dataSet.&quot;
# &quot;fastFilterVariables: I check for columns in double.&quot;
# &quot;fastFilterVariables: I check for columns that are bijections of another column.&quot;
# &quot;fastFilterVariables: I delete 3 column(s) that are bijections of another column in dataSet.&quot;
# &quot;unFactor: I will identify variable that are factor but shouldn't be.&quot;
# &quot;unFactor: I unfactor mail.&quot;
# &quot;unFactor: It took me 0.25s to unfactor 1 column(s).&quot;
# &quot;findAndTransformNumerics: It took me 0.23s to identify 2 numerics column(s), i will set them as numerics&quot;
# &quot;setColAsNumeric: I will set some columns as numeric&quot;
# &quot;setColAsNumeric: I will set some columns as numeric&quot;
# &quot;setColAsNumeric: I am doing the column num2.&quot;
# &quot;setColAsNumeric: 0 NA have been created due to transformation to numeric.&quot;
# &quot;setColAsNumeric: I am doing the column num3.&quot;
# &quot;setColAsNumeric: 0 NA have been created due to transformation to numeric.&quot;
# &quot;findAndTransformNumerics: It took me 0.05s to transform 2 column(s) to a numeric format.&quot;
# &quot;findAndTransformDates: It took me 0.74s to identify formats&quot;
# &quot;findAndTransformDates: It took me 0.06s to transform 3 columns to a Date format.&quot;
# &quot;prepareSet: step two: transforming dataSet.&quot;
# &quot;generateDateDiffs: I will generate difference between dates.&quot;
# &quot;generateDateDiffs: It took me 0.02s to create 6 column(s).&quot;
# &quot;generateFactorFromDate: I will create a factor column from each date column.&quot;
# &quot;generateFactorFromDate: It took me 0.72s to transform 3 column(s).&quot;
# &quot;generateFromCharacter: it took me: 0.01s to transform 1 character columns into, 3 new columns.&quot;
# &quot;aggregateByKey: I start to aggregate&quot;
# &quot;aggregateByKey: 164 columns have been constructed. It took 0.5 seconds. &quot;
# &quot;prepareSet: step three: filtering dataSet.&quot;
# &quot;fastFilterVariables: I check for constant columns.&quot;
# &quot;fastFilterVariables: I delete 2 constant column(s) in result.&quot;
# &quot;fastFilterVariables: I check for columns in double.&quot;
# &quot;fastFilterVariables: I delete 1 column(s) that are in double in result.&quot;
# &quot;fastFilterVariables: I check for columns that are bijections of another column.&quot;
# &quot;fastFilterVariables: I delete 34 column(s) that are bijections of another column in result.&quot;
# &quot;prepareSet: step four: handling NA.&quot;
# &quot;prepareSet: step five: shaping result.&quot;
# &quot;Transforming numerical variables into factors when length(unique(col)) &lt;= 10.&quot;
# &quot;Previous distribution of column types:&quot;
# col_class_init
#  factor numeric 
#       1     126 
# &quot;Current distribution of column types:&quot;
# col_class_end
#  factor numeric 
#      33      94</code></pre>
<p>As one can see, every previously steps have been done.</p>
<p>Let’s have a look to the result</p>
<pre><code># &quot;127 columns have been built; for 42 countries.&quot;</code></pre>
<table class="table table-striped table-hover" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
country
</th>
<th style="text-align:right;">
nbrLines
</th>
<th style="text-align:left;">
mean.num2
</th>
<th style="text-align:left;">
sd.num2
</th>
<th style="text-align:left;">
mean.num3
</th>
<th style="text-align:left;">
sd.num3
</th>
<th style="text-align:right;">
mean.age
</th>
<th style="text-align:left;">
…
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
?
</td>
<td style="text-align:right;">
520
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
38.58
</td>
<td style="text-align:left;">
…
</td>
</tr>
<tr>
<td style="text-align:left;">
Cambodia
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
37.41
</td>
<td style="text-align:left;">
…
</td>
</tr>
<tr>
<td style="text-align:left;">
Canada
</td>
<td style="text-align:right;">
112
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
42.07
</td>
<td style="text-align:left;">
…
</td>
</tr>
<tr>
<td style="text-align:left;">
China
</td>
<td style="text-align:right;">
69
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
42.72
</td>
<td style="text-align:left;">
…
</td>
</tr>
<tr>
<td style="text-align:left;">
Columbia
</td>
<td style="text-align:right;">
53
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
39.92
</td>
<td style="text-align:left;">
…
</td>
</tr>
<tr>
<td style="text-align:left;">
Cuba
</td>
<td style="text-align:right;">
86
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
45.81
</td>
<td style="text-align:left;">
…
</td>
</tr>
</tbody>
</table>
</div>
<div id="description" class="section level1">
<h1><span class="header-section-number">8</span> Description</h1>
<p>Finally, to generate a description file from this data set, function <code>description</code> is available.</p>
<p>It will describe, the set and its variables. Here we put <code>level=0</code> to have some global descriptions:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">description</span>(agg_adult, <span class="dt">level =</span> <span class="dv">0</span>)</code></pre></div>
<pre><code># &quot;dataSet is a data.table-data.frame&quot;
# [1] &quot;dataSet contains 42 rows and 127 cols.&quot;
# [1] &quot;Columns are of the following classes:&quot;
# 
#  factor numeric 
#      33      94</code></pre>
</div>
<div id="conclusion" class="section level1">
<h1><span class="header-section-number">9</span> Conclusion</h1>
<p>We presented some of the functions of <em>dataPreparation</em> package. There are a few more available, plus they have some parameters to make their use easier. So if you liked it, please go check the package documentation (by installing it or on <a href="https://cran.r-project.org/web/packages/dataPreparation/dataPreparation.pdf">CRAN</a>)</p>
<p>We hope that this package is helpful, that it helped you prepare your data in a faster way.</p>
<p>If you would like to give us some feedback, report some issues, add some features to this package, please tell us on <a href="https://github.com/ELToulemonde/dataPreparation/issues">GitHub</a>. Also if you want to contribute, please don’t hesitate to contact us.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
